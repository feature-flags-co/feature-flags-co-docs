# 高频/精细的发布功能, 安全/无忧的运营产品

让功能的发布/下线/回退 精细化到每个用户、每一个模块、每一分钟、每一种技术环境、每一个实用场景。

我们将以微信小程序为案例，描述敏捷开关是如何作用于功能模块，让发布功能做的更高频/惊喜，让运营变的更安全/无忧。

## 需求分析

小程序"demo"希望添加一个新的功能，团队希望新功能可以进行快速迭代、试错。希望实现:

- 功能产品可以尽快得到市场反馈，从而快速调整方向
- 尽量把产品新功能的BUG扼杀在摇篮中

## 在Portal中创建并初始化配置开关

- 为了尽快得到市场反馈，团队决定让市场专员使用mock数据的版本去市场展示获得反馈。
- 用灰度发布的模式，先发布1%给早期用户，如果有BUG，我们可以在用户数量上降低影响。

于是我们可以将开关定义如下三个状态:

- `true & real data`, 使用真实数据向匹配用户开放功能
- `true & demo data`, 使用mock数据向匹配用户开放功能
- `false`,  不展示功能

并在一开始将`RD`，`PM`组的用户返回`true & real data`，其他用户返回`false`。

![type:video](./videos/建立开关并初始化配置.mp4)


## 使用开关将我们的功能包裹

完整代码请查看 [gtihub敏捷开关微信小程序插件demo](https://github.com/feature-flags-co/ffc-sdk-wechat-miniprogram/tree/main/demo) 

### 引入"敏捷开关"微信小程序插件进入我们的demo项目

![type:video](./videos/引入微信小程序SDK.mp4)

### 注入敏捷开关代码，包裹功能

![type:video](./videos/使用开关将我们的功能包裹.mp4)

## 发布未完成的功能

为了最快的向市场求证新功能的定位是否准确，我们将使用模拟数据的版本暴露给市场专员，让他们可以拿着小程序去做市场反馈。

此时，我们将模拟数据功能暴露给`BD`组的用户

![type:video](./videos/发布未完成的功能.mp4)


## 发布完成的初版功能给1%的市场用户

我们根据市场专员的反馈进行了及时调整，并尽快出了第一个版本。为了避免新版本的BUG影响用户对品牌的信任，我们决定只将新功能发给1%的市场用户。

![type:video](./videos/发布完成的初版功能给1%的市场用户.mp4)


## 逐步发布功能给剩下的用户

![type:video](./videos/逐步发布功能给剩下的用户.mp4)







