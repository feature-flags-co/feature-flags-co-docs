# 细粒度发布、回退功能

点击左侧菜单中的"开关管理" -> 找到对应的开关并点击"详情" -> 在"目标条件中"配置条件并保存，即可做细粒度的发布和回退。

## 条件配置

### 如果开关关闭了，应返回

在页面的最后端，可设置当开关关闭时，返回的状态。此状态不支持百分比分配。

![](/quickstart/img/4-1关闭状态.png)

### 开启或关闭开关

"开启或关闭开关"开关按钮可以控制按钮是处于开始状态还是关闭状态。当开关为关闭状态时，则返回"如果开关关闭了，应返回"设置中设置的值。

![](/quickstart/img/4-2开关.png)

###上游开关

服务端在进行开关与用户的匹配判断时，首先会判断是否有"上游开关"。如下图所示，系统会先将用户与开关"VIP用户页面"进行沟通，当开关返回状态为"普通VIP"时，则用户与上游开关设置匹配，则在当前开关中，继续向下判断（"目标用户"）。否则，将返回"如果开关关闭了，应返回"中设置的开关状态。

![](/quickstart/img/4-3上游开关.png)

### 目标用户

在目标用户中，可直接对不同的状态选择特定的用户。如果当前用户出现在某一个状态的目标用户中，则将立即返回改状态。如下图所示，用户"用户ABC"使用该开关时，将获得状态"A"。如果用户并不在任何的状态的目标用户中，判断逻辑则跳到下一步"使用匹配条件找到目标用户"。

![](/quickstart/img/4-4-1目标用户.png)

![](/quickstart/img/4-4-2postman.png)

### 使用匹配条件找到目标用户

使用"用户属性"做灵活多样的规则设定。在这个条件判断模块，可以加入多个"规则"，每个规则内可以键入多个"规则条件"。

- 同一规则内的"规则条件"是"并且的关系"。
- 规则之间是"或"的关系，且判断顺序由上至下。如果用户首先符合了上面的规则，则会返回该规则对应的状态。

如下图所示，在规则1中，当用户年龄在18岁至28岁之间，来自于北京、南京等城市的女性中，60%将会使用版本A，20%使用版本B，20%使用版本C。

![](/quickstart/img/4-5自定义规则.png)

如下为规则设定的条件的解释:

| 规则条件          |           描述               |
| :---------------- | :----------------------------------- |
| Is True             | 左侧属性值为true时 |
| Is False        | 左侧属性值为false时 |
| =       |  左侧属性值等于右侧输入值时 |
| !=       | 左侧属性值不等于右侧输入值时  |
| <=       |  左侧属性值小于等于右侧输入值时（只限数字） |
| <       | 左侧属性值小于右侧输入值时（只限数字）  |
| >=       | 左侧属性值大于等于右侧输入值时（只限数字）  |
| >       | 左侧属性值大于右侧输入值时（只限数字）  |
| Is one of       |  左侧属性值属于右侧数据中的任何一项 |
| not one of       | 左侧属性值不属于右侧数据中的任何一项  |
| Contains       | 左侧属性值包含右侧的字符串时  |
| Not contain       | 左侧属性值不包含右侧的字符串时  |
| Starts with       | 右侧的字符串作为左侧属性值的起始值  |
| Ends with       |  右侧的字符串作为左侧属性值的结束值 |

### 默认返回值

当用户满足"上游开关"，但不满足"目标用户"，也不满足"使用匹配条件找到目标用户"时，则会根据"默认返回值"的设置返回对应的状态。此处可设置返回单独的状态，也可按照百分比设置返回状态（即当前用户会根据百分比算法自动返回某个状态）。

![](/quickstart/img/4-6默认返回值.png)

-----

## 保存配置

配置完成后，可立即点击保存，保存配置。保存配置后，当用户对应的功能重新进行与服务端的沟通时，即可生效。通过配置条件并保存，就可以将任意的功能发布给任意的用户，同理也可以对某个用户做功能回退。整个过程就是一个操作功能显示、隐藏给用户的过程。

![](/quickstart/img/4-7保存设置.png)



-----


## 后续操作

- [第5步, 收集数据（pageview, click, custom event）](/quickstart/send-event/)
- [第6步, 数据实验（ab测试）](/quickstart/abtest/)

!!! 推荐章节

    [Flag判断条件流程图](/quickstart/flag-check-variation-flow/)
    
